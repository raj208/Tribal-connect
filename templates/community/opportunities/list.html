{% extends "base.html" %}
{% load roles %}
{% block title %}Opportunities | Tribal Community{% endblock %}

{% block content %}
  <div class="card" style="margin-bottom:14px;">
    <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
      <h2 style="margin:0;">Opportunity Board</h2>

      <div style="margin-left:auto; display:flex; gap:10px; align-items:center;">
        {% if user.is_authenticated %}
          <a href="/opportunities/submit/">+ Submit</a>
        {% else %}
          <a href="/login/">Login to submit</a>
        {% endif %}

        {% if user|is_moderator_user %}
          <a href="/opportunities/mod/">Mod Queue</a>
        {% endif %}
      </div>
    </div>

    <form method="get" style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <input type="text" name="q" placeholder="Search title/description" value="{{ q }}" />
      <input type="text" name="type" placeholder="Type (scholarship/scheme...)" value="{{ typ }}" />
      <button type="submit">Search</button>
      <a href="/opportunities/" class="muted">Clear</a>

      <select name="sort">
        <option value="new" {% if sort == "new" %}selected{% endif %}>Newest</option>
        <option value="deadline" {% if sort == "deadline" %}selected{% endif %}>Deadline</option>
      </select>

    </form>
  </div>

  {% for o in opps %}
    <div class="card" style="margin-bottom:12px;">
      <div class="muted" style="font-size:14px;">
        {% if o.opportunity_type %}{{ o.opportunity_type }} • {% endif %}
        Posted {{ o.created_at|date:"M d, Y" }}
        {% if o.deadline %} • Deadline: {{ o.deadline }}{% endif %}
      </div>

      <h3 style="margin:8px 0 6px;">
        <a href="/opportunities/{{ o.id }}/">{{ o.title }}</a>
      </h3>

      <p class="muted" style="margin:0;">{{ o.description|truncatechars:220 }}</p>
    </div>
  {% empty %}
    <div class="card"><p class="muted">No opportunities yet.</p></div>
  {% endfor %}
{% endblock %}
