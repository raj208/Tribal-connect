{% extends "base.html" %}
{% block title %}Feed | Tribal Community{% endblock %}

{% block content %}

<form method="get" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
  <input type="text" name="q" placeholder="Search posts..." value="{{ q }}" />

  <select name="type">
    <option value="">All Types</option>
    {% for val,label in post_types %}
      <option value="{{ val }}" {% if selected_type == val %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>

  <input type="text" name="tag" placeholder="Tag (optional)" value="{{ selected_tag }}" />

  <button type="submit">Apply</button>
  <a href="/feed/" class="muted">Clear</a>

  <div style="margin-left:auto;">
    {% if user.is_authenticated %}
      <a href="/feed/create/">+ Create Post</a>
    {% else %}
      <a href="/login/">Login to post</a>
    {% endif %}
  </div>
</form>

{% if top_tags %}
  <div style="margin-top:10px;">
    <span class="muted">Quick tags:</span>
    {% for t in top_tags %}
      <a href="/feed/?tag={{ t.name }}" style="margin-left:8px;">#{{ t.name }}</a>
    {% endfor %}
  </div>
{% endif %}



  {% for p in posts %}
    <div class="card" style="margin-bottom:12px;">
      <div class="muted" style="font-size:14px;">
        {{ p.get_post_type_display }} • by {{ p.author.username }} • {{ p.created_at|date:"M d, Y H:i" }}
      </div>
      <h3 style="margin:8px 0 6px;">
        <a href="/feed/{{ p.id }}/">{{ p.title }}</a>
      </h3>
      <p class="muted" style="margin:0;">
        {{ p.body|truncatechars:180 }}
      </p>
      <div class="muted" style="margin-top:10px; font-size:14px;">
        Images: {{ p.images.count }} • Comments: {{ p.comments.count }}
      </div>
    </div>
  {% empty %}
    <div class="card">
      <p class="muted">No posts yet.</p>
    </div>
  {% endfor %}
{% endblock %}
