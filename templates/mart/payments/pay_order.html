{% extends "base.html" %}
{% block title %}Pay Order #{{ order.id }}{% endblock %}

{% block content %}
  <h2 class="mb-2">Pay Order #{{ order.id }}</h2>
  <p class="text-muted">Amount: <b>â‚¹{{ amount_rupees }}</b></p>

  <button id="rzp-button" class="btn btn-dark">Pay with Razorpay</button>

  <form id="rzp-verify-form" method="post" action="{% url 'payments:verify_payment' order.id %}" style="display:none;">
    {% csrf_token %}
    <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
    <input type="hidden" name="razorpay_signature" id="razorpay_signature">
  </form>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    const options = {
      key: "{{ razorpay_key_id }}",
      amount: "{{ amount_paise }}",
      currency: "INR",
      name: "Tribal Mart",
      description: "Order #{{ order.id }}",
      order_id: "{{ order.razorpay_order_id }}",
      handler: function (response) {
        document.getElementById("razorpay_payment_id").value = response.razorpay_payment_id;
        document.getElementById("razorpay_signature").value = response.razorpay_signature;
        document.getElementById("rzp-verify-form").submit();
      }
    };

    const rzp = new Razorpay(options);
    document.getElementById("rzp-button").onclick = function(e){
      rzp.open();
      e.preventDefault();
    }
  </script>
{% endblock %}
